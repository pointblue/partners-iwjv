<!DOCTYPE html>
<html ng-app="app">
<head>
    <title>Intermountain West Joint Venture</title>

    <script type="text/javascript">


        //
        // MIGRATION CONFIGARTION
        //

        //TODO: Remove this script section when migration is complete

        var SITE_PROTOCOL = 'http';            //Typical protocol used to access this site (used for hardlinking)
        var SITE_HOST = 'data.pointblue.org';  //The production server that this tool is running on
        var SITE_ROUTE = '/parnerts/iwjv';     //Path to this tool relative to the SITE_HOST constant

        var API_PROTOCOL = 'http';         //Protocol to be used when making a request to the API (Example: https)
        var API_HOST = 'data.prbo.org';    //Host server for the api (Example: data.prbo.org)
        var API_ROUTE = '/api/v1/';        //Route for the api that is being called (Example: /api/v1/) Trailing '/' must be provided if it is necessary to make a successful request.
        var API_ROUTE_HABPOP = 'habpop/';
        var API_ROUTE_HABPOP_STATEGONS = 'stategons/';
        var API_ROUTE_HABPOP_ESTIMATES = 'estimates/';

        var GEO_PROTOCOL = 'http';         //Protocol to be used when making a request to the API (Example: https)
        var GEO_HOST = 'geo.pointblue.org';    //Host server for the api (Example: data.prbo.org)
        //Export variables defined in config.php to Javascript
        var ACTIVE_HOST = "localhost";      //The active value being used in places where SITE_HOST would normally be used. This allows us to dynamically change it when working locally.

        var GEO_FULL_URL = GEO_PROTOCOL + '://' + GEO_HOST;                 //Geoserver full url
        var API_FULL_URL = API_PROTOCOL + "://" + API_HOST + API_ROUTE;     //data.prbo.org api v1 full url
        var API_HABPOP_STATEGONS_URL = API_FULL_URL + API_ROUTE_HABPOP + API_ROUTE_HABPOP_STATEGONS;    //habpop stategons api full url
        var API_HABPOP_ESTIMATES_URL = API_FULL_URL + API_ROUTE_HABPOP + API_ROUTE_HABPOP_ESTIMATES;    //habpop estimates api full url
    </script>
    <script src="inc/js/ext-3.4.0/adapter/ext/ext-base.js"></script>
    <script src="inc/js/ext-3.4.0/ext-all.js"></script>
    <script src="inc/js/OpenLayers-2.11/OpenLayers.js"></script>
    <script src="inc/js/GeoExt/lib/GeoExt.js" ></script>
    <script src="inc/js/jquery.js"></script>
    <script src="inc/js/underscore.js"></script>


    <!-- https://github.com/johnpapa/angular-styleguide -->
    <script src="inc/js/angular.js"></script>
    <script src="app/OpenLayers.module.js"></script>
    <script src="app/underscore.module.js"></script>
    <script src="app/app.module.js"></script>
    <script src="app/app.config.js"></script>
    <script src="app/app.run.js"></script>
    <script src="app/stategon.factory.js"></script>
    <script src="app/estimates.factory.js"></script>
    <script src="app/habpopmap.factory.js"></script>
    <script src="app/conditionnames.factory.js"></script>
    <script src="app/habpop.controller.js"></script>

    <script type="text/javascript">var __BASEHOST = window.location.host;</script>

    <link type="text/css" rel="stylesheet" href="inc/css/iwjvmap.css">
    <!--
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-40690497-30']);
        _gaq.push(['_trackPageview']);

        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();

    </script>
    -->

    <script type="text/javascript" src="inc/js/imjvmap.js"></script>
</head>
<body>
    <div id="iwjvContainer" ng-controller="Habpop as vm">
        <div id="siteTitleContainer">
            <h1>Inter-Mountain West Joint Venture Mapping Tool</h1>
            <a href="http://iwjv.org/" target="_blank"><img src="./uploads/img/IWJV_logo.png" /></a>
        </div>
        <div id="subtitle"><h2>Habitats and Populations Strategies (HABPOPS) Database</h2></div>
        <div id="iwjvBodyContainer">
            <div id="gxmap"></div>
            <div id="panel" class="olControlEditingToolbar"></div>
            <div id="mapSidebarRightContainer">
                <div id="buttonContainer">
                    <button type="button" id="instr_button"  class="defaultButton" value="instr" ng-click="vm.showBirdInfo(null)">Instructions</button>
                    <button type="button" class="defaultButton" value="sasp" ng-click="vm.showBirdInfo('sasp')">Sage Sparrow</button>
                    <button type="button" class="defaultButton" value="sath" ng-click="vm.showBirdInfo('sath')">Sage Thrasher</button>
                    <button type="button" class="defaultButton" value="brsp" ng-click="vm.showBirdInfo('brsp')">Brewer's Sparrow</button>
                    <button type="button" class="defaultButton" value="lbcu" ng-click="vm.showBirdInfo('lbcu')">Long-billed Curlew</button>
                    <button type="button" class="defaultButton" value="grsp" ng-click="vm.showBirdInfo('grsp')">Grasshopper Sparrow</button>
                </div>
                <div id="birdInfoContainer" ng-show="!!vm.selectedBirdInfoSpecies">
                    <div id="birdImgInfo" class="birdInfo birdInfoBackground-{{vm.selectedBirdInfoSpecies}}">
                        <div ng-show="vm.selectedBirdInfoSpecies === 'brsp'">
                            <span class="birdInfoTotalPopulation brsp">Brewers Sparrow</span>
                            <span class="birdInfoHabitatsConditions brsp">
                                Tall, dense or patchy sagebrush<br>>10% sagebrush cover<br>
                                Some bare ground with >10% native herbaceous<br>
                                Minimum block size of 8ha
                            </span>
                        </div>
                        <div ng-show="vm.selectedBirdInfoSpecies === 'grsp'">
                            <span class="birdInfoTotalPopulation grsp">Grasshopper Sparrow</span>
                            <span class="birdInfoHabitatsConditions grsp">
                                Grasslands, preferably tall bunchgrass<br>
                                Moderate litter levels, low shrub density<br>
                                <10% woody vegetation
                            </span>
                        </div>
                        <div ng-show="vm.selectedBirdInfoSpecies === 'lbcu'">
                            <span class="birdInfoTotalPopulation lbcu">Long-billed Curlew</span>
                            <span class="birdInfoHabitatsConditions lbcu">
                                Open, patchy sagebrush<br>Grasslands with average heights <30cm<br>
                                Prefer proximity to shallow wetlands/wet meadows
                            </span>
                        </div>
                        <div ng-show="vm.selectedBirdInfoSpecies === 'sasp'">
                            <span class="birdInfoTotalPopulation sasp">Sage Sparrow</span>
                            <span class="birdInfoHabitatsConditions sasp">
                                Sagebrush cover 15-30%, 50-100 cm tall<br>
                                Tall, dense  or patchy sagebrush
                            </span>
                        </div>
                        <div ng-show="vm.selectedBirdInfoSpecies === 'sath'">
                            <span class="birdInfoTotalPopulation sath">Sage Thrasher</span>
                            <span class="birdInfoHabitatsConditions sath">
                                    Tall, dense  or patchy sagebrush<br>Less grass cover, some bare ground<br>
                                Prefers 20-40% sagebrush cover, >55cm tall
                            </span>
                        </div>
                    </div>
                    <div id="photoCredit">
                        <span ng-show="vm.selectedBirdInfoSpecies === 'brsp'">Photo by Greg Lavaty</span>
                        <span ng-show="vm.selectedBirdInfoSpecies === 'grsp'">Photo by Chuck Carlson</span>
                        <span ng-show="vm.selectedBirdInfoSpecies === 'lbcu'">Photo by Bob Martinka</span>
                        <span ng-show="vm.selectedBirdInfoSpecies === 'sasp'">Photo by Greg Lavaty</span>
                        <span ng-show="vm.selectedBirdInfoSpecies === 'sath'">Photo by Greg Lavaty</span>
                    </div>
                </div>
                <div id="mapInstructionContainer" ng-show="!vm.selectedBirdInfoSpecies">
                    <h2>Mapping Tool Use</h2>
                    <p>
                        Click on the map to place a marker <img src="icons/marker.png" style="vertical-align:middle"/> and generate report
                        for the selected State / Bird Conservation Region (BCR) including habitat composition, populations of bird species,
                        and goals for their future populations.
                    </p>
                    <p>Select a bird species button for information about the species' habitat preferences.</p>
                    <p>The population worksheet estimates the effects of various habitat conservation efforts on regional bird populations.</p>
                    <p>
                        This mapping tool was developed to help resource and land managers develop and implement habitat
                        conservation projects that are both strategic and effective. It allows planners to explore the
                        impact that various restoration and management plans have on bird populations for BCR's 9, 10 and 16 within the
                        Intermountain West Joint Venture (IWJV) region.
                    </p>
                    <p>
                        This mapping tool was developed as a collaborative effort between IWJV, ABC, and Point Blue Conservation Science.
                    </p>
                </div>
            </div>
            <!--

            STATEGON INFORMATION (DETAILS)

            -->
            <div id="stategonInformationContainer" ng-show="vm.stategon">
                <div>
                    <h2>Regional Habitats</h2>
                    <!--
                    <a ng-href="http://data.pointblue.org/partners/iwjv/uploads/img/{{vm.stategon.code}}.jpg" target="_blank">
                        <img ng-src="http://data.pointblue.org/partners/iwjv/uploads/img/{{vm.stategon.code}}.jpg" style="width:250px;float:left;margin-right: 20px;">
                    </a>
                    -->
                    Bird Conservation Region: {{vm.stategon.details.bcr}}, {{vm.stategon.details.state}}
                    <br>
                    Total Habitat Acreage: {{vm.stategon.details.acres}}
                    <br>
                    <a ng-href="{{vm.stategon.details.iwjv}}" target="_blank" class="iwjv">Conservation Plan for Bird Conservation Area - PDF</a><br>
                    <a ng-href="{{vm.stategon.details.swap}}" target="_blank" class="swap">Regional Wildlife Action Plan - PDF</a><br>
                    <a ng-href="http://data.pointblue.org/partners/iwjv/uploads/img/{{vm.stategon.code}}.jpg" target="_blank">Region Map</a>
                </div>

                <div ng-repeat="habitatSets in vm.stategon.habitats.byconditionset" style="clear:both;">
                    <table class="stategonInfoTable" cellspacing="0">
                        <thead>
                            <tr>
                                <th ng-if="$index === 0">Habitat Type</th>
                                <th ng-if="$index !== 0"></th>
                                <th ng-repeat="condtion in habitatSets.setConditions">{{condtion}}</th>
                                <th ng-if="habitatSets.setConditions.length < 2">{{condtion}}</th>
                                <th ng-if="habitatSets.setConditions.length < 3">{{condtion}}</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="habitat in habitatSets.setData" ng-class="{odd:($index+1)%2!==0}">
                                <td>{{habitat.ASSOCIATION}}</td>
                                <td ng-repeat="conditiontotal in habitat.CONDITION_TOTALS track by $index" class="total">{{conditiontotal}}</td>
                                <td ng-if="habitat.CONDITION_TOTALS.length < 2" class="total"></td>
                                <td ng-if="habitat.CONDITION_TOTALS.length < 3" class="total"></td>
                                <td class="total">{{habitat.TOTAL}}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <!--

            SPECIES INFORMATION (FOR STATEGON)

            -->
            <div id="speciesInformationContainer" ng-show="vm.stategon">
                <h2>Species Populations</h2>
                <table id="speciesTable" cellspacing="0">
                    <thead>
                        <tr>
                            <th>Species Name</th>
                            <th>Occupied Acres</th>
                            <th>Population Estimate</th>
                            <th>Population Objective</th>
                            <th>Objective Increase</th>
                            <th>Before</th>
                            <th>After</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="species in vm.stategon.speciestable" class="speciesTableRow" ng-class="{odd:($index+1)%2!==0}">
                            <td>{{species.SpeciesName}}</td>
                            <td>{{species.OccupiedAcres}}</td>
                            <td>{{species.PopEstimate}}</td>
                            <td>{{species.PopObjective}}</td>
                            <td>{{species.ObjectiveIncrease}}</td>
                            <td class="before">{{vm.estimate.before[species.SPECIES]}}</td>
                            <td class="after">{{vm.estimate.after[species.SPECIES]}}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <!--

            POPULATION WORKSHEET

            -->
            <div id="populationWorksheetsContainer" ng-show="vm.stategon">
                <h2>Population Worksheet</h2>
                <p>
                    Enter acres for each habitat you have (before) and will restore (after), then click 'calculate'.<br>
                    Estimates appear in before / after columns of Species Population table above.<br>
                    For descriptions of the habitats/conditions, click on the links in the worksheet below.
                </p>
                <div class="calculateButtonContainer">
                    <button class="defaultButton" type="button" ng-click="vm.submitWorksheets()">Calculate</button>
                </div>
                <div class="worksheetContainer" ng-repeat="habitatSets in vm.stategon.habitats.byconditionset" ng-init="parentIndex = $index" style="clear: both;">
                    <table class="worksheetTable" cellspacing="0">
                        <thead>
                            <tr ng-if="$index === 0">
                                <th>Habitat Type</th>
                                <th colspan="3" class="before">Condition Before<br>(Acres)</th>
                                <th colspan="3" class="after">Condition After<br>(Acres)</th>
                            </tr>
                            <tr>
                                <th>&nbsp;</th>
                                <!-- before columns -->
                                <th ng-repeat="condition in habitatSets.setConditions" class="before">{{condition}}</th>
                                <th ng-if="habitatSets.setConditions.length < 2" class="before"></th>
                                <th ng-if="habitatSets.setConditions.length < 3" class="before"></th>
                                <!-- after columns -->
                                <th ng-repeat="condition in habitatSets.setConditions" class="after">{{condition}}</th>
                                <th ng-if="habitatSets.setConditions.length < 2" class="after"></th>
                                <th ng-if="habitatSets.setConditions.length < 3" class="after"></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="habitat in habitatSets.setData" ng-init="habitatIndex = $index" ng-class="{odd:($index+1)%2!==0}">
                                <td><a href="uploads/pdf/{{habitat.LINK}}" target="_blank">{{habitat.ASSOCIATION}}</a></td>
                                <!-- before columns -->
                                <td ng-repeat="condition in habitat.setConditionsBefore" class="before">
                                    <input type="text" ng-model="vm.worksheetModels['before'][habitat.MASTERCODE + '.' + ($index + 1)]"
                                            title="Acres of {{habitat.ASSOCIATION}} as {{habitatSets.setConditions[$index]}} (before)">
                                </td>
                                <td ng-if="habitat.CONDITION_TOTALS.length < 2" class="before"></td>
                                <td ng-if="habitat.CONDITION_TOTALS.length < 3" class="before"></td>
                                <!-- after columns -->
                                <td ng-repeat="condition in habitat.setConditionsAfter" class="after">
                                    <input type="text" ng-model="vm.worksheetModels['after'][habitat.MASTERCODE + '.' + ($index + 1)]"
                                           title="Acres of {{habitat.ASSOCIATION}} as {{habitatSets.setConditions[$index]}} (after)">
                                </td>
                                <td ng-if="habitat.CONDITION_TOTALS.length < 2" class="after"></td>
                                <td ng-if="habitat.CONDITION_TOTALS.length < 3" class="after"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="calculateButtonContainer">
                    <button class="defaultButton" type="button" ng-click="vm.submitWorksheets()">Calculate</button>
                </div>
            </div>
        </div>
        <div class="footer">
            <div id="prbo"><a href="http://www.pointblue.org/" target="_blank" ><img src="images/PB_logo_notag_sm90.jpg"></a> powered by Point Blue Data Solutions</div>
            <div id="abc"><a href="http://www.abcbirds.org/" target="_blank" ><img src="./uploads/img/ABC_logo.jpg" /></a></div>
        </div>
    </div>

</body>
</html>